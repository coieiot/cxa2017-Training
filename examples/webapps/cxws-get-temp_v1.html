<!DOCTYPE html>
<html>

<head>
  <title>CX Weather Stations</title>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .section {
      margin: 20px;
    }
    button {
      padding: 5px 16px;
      border-radius: 4px;
    }   
    button#getTemperature { background-color: #98fb98; }   
  </style>

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

  <script type="text/javascript">
  	
  	window.onload = function() {
  		

  		$("#getTemperature").click(function() {

        $("#temperatureResult").html(" ");
  			var inputName = $("#weatherStationName").val();
        inputName = inputName.trim();

        if (inputName === "") {          
          alert("Oops! Please type in weather station name.");
        } else {

          var urlString = "http://sg2017-sta.sensorup.com/v1.0/Things?$filter=name eq '" + inputName + "'";

          $.get(urlString, function(response, status) {

            if (response.value.length===0) {
              alert("Sorry, no such weather station.")
            } else {

              var selfLink = response.value[0]["@iot.selfLink"];
			  var urlString1 = selfLink + "/Datastreams?$filter=name eq 'Temperature'&$select=Observations&$expand=Observations($select=result)";

              /*** What if the weather station has more than one datastream and the first datastream is not the temperature stream? ***/

              $.get(urlString1, function(response, status) {

                  $("#temperatureResult").html(response.value[0].Observations[0].result + " degC");   // assuming the first observation is the latest measurement

              });

            }           
              
          }); 

        }  			

  		});

  	};
	

  </script>
 
</head>

<body>
	
	<h1>CX Weather Stations</h1>

	<hr/>
  
  	<div class="section">
    	<h2>Get the latest temperature</h2>
    	Enter weather station name: <input type="text" id="weatherStationName" value="SGWeatherStation1" /> 
      <button id="getTemperature">Get Temperature</button>
      <span id="temperatureResult"></span>
  	</div>

  <hr/>

</body>


</html>